@(msb: models.memento.MementoQuery, searchForm: Form[models.Query])
@import helper.twitterBootstrap._

<!DOCTYPE html>

<html>
    <head>
        <title>BlueBox - @msb.getUrl()</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	    <meta name="description" content="UK Web Archive - BlueBox"/>
    	<meta name="author" content="www.webarchive.org.uk"/>

        <link rel="stylesheet" media="screen" href="@routes.Assets.at("stylesheets/main.css")">
        <link rel="stylesheet" media="screen" href="@routes.Assets.at("bootstrap/css/bootstrap.css")">
        <link rel="stylesheet" media="screen" href="@routes.Assets.at("bootstrap/css/bootstrap-responsive.css")">
        <link rel="stylesheet" media="screen" href="@routes.Assets.at("nvd3/src/nv.d3.css")">
        <link rel="shortcut icon" type="image/png" href="@routes.Assets.at("images/favicon.png")">
        <script src="@routes.Assets.at("javascripts/jquery-1.7.1.min.js")" type="text/javascript"></script>
        <script src="@routes.Assets.at("javascripts/jquery.dataTables.min.js")" type="text/javascript"></script>
        <script src="@routes.Assets.at("nvd3/lib/d3.v2.min.js")" type="text/javascript"></script>
        <script src="@routes.Assets.at("nvd3/nv.d3.min.js")" type="text/javascript"></script>
        <script src="@routes.Assets.at("bootstrap/js/bootstrap.min.js")" type="text/javascript"></script>
    </head>
    <body>

     <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="http://www.webarchive.org.uk/"><img src="@routes.Assets.at("/images/ukwa-icon-nobg-16.png")"/>UK Web Archive</a>
          <div class="nav-collapse">
            <ul class="nav">
              <li><a href="http://www.webarchive.org.uk/">Home</a></li>
              <li class="active"><a href="@routes.Application.index()">BlueBox</a></li>
              <li><a href="https://github.com/ukwa/">GitHub</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>
    
    <div class="container">

      @helper.form(action = routes.Application.findMementos(), 'id -> "searchForm", 'class -> "form-horizontal form-inline" ) {
      <div class="row first-row">
        <div class="span1 offset4">
          <img src="@routes.Assets.at("/images/mementologo.png")"/>
        </div>
          <div class="span3" style="text-align: center;">
            @helper.inputText(searchForm("url"),'id -> "idQueryUrl", '_label -> "Enter URL:", '_showConstraints -> false )
          </div>
       </div>
      <div class="row">
          <div class="span12" style="text-align: center;">
            <input type="submit" class="btn primary" value="Engage The TimeGate...">
          </div>
          <div class="span12" style="text-align: center;">
            @if(searchForm.hasGlobalErrors) { 
                <div class="alert alert-error">
                <a class="close" data-dismiss="alert">×</a>
                    @searchForm.globalError.message
                </div>
            }
            @if(flash.contains("success")) {
                <div class="alert alert-success">
                <a class="close" data-dismiss="alert">×</a>
                    @flash.get("success")
                </div>
            }
        </div>
      </div>
      }

      
      @if(msb.hasValidResults()) {

      <div class="row">
      <div class="span8">
      <p>
        This URL (<a href="@msb.getUrl()">@msb.getUrl()</a>) has been archived @msb.getTotalCount() times by @msb.getNumHosts() organisation(s) between @msb.getFirstMemento().getDateTime().getYear() and @msb.getLastMemento().getDateTime().getYear().
      </p>
      <p>
        Also available as&#160;<h:outputLink value="#{mementoBackingBean.absoluteUrl}/timegate/json?url=#{mementoBackingBean.url}">JSON</h:outputLink>.
      </p>
      <p>
        <a href="http://webcitation.org/archive?url=@msb.getUrl()">Click here to use WebCite&#153; to archive @msb.getUrl()</a>.
      </p>
      

    <table id="host_summary" class="table table-striped table-condensed table-bordered">
        <thead>
            <th>Archival Host</th>
            <th>Archived Versions</th>
        </thead>
        <tbody>
        @for(h <- msb.getHosts()) {
            <tr>
                <td>
            <img src="@routes.Assets.at("images/favicons/"+h+"/favicon.ico")"/>&#160;<a href="http://@h">@h</a>
                </td>
                <td>@msb.getHostCounts().get(h)</td>
            </tr>
        }
        </tbody>
    </table>

    </div>
    <div class="span4">
                
<svg id="test1" style="width: 300px; height: 300px;"></svg>

<script> 

  var testdata = [ 
                  {
                	    key: "Archive Hosts",
                	    values: [
                       @Html(msb.getHostPieData())
                   ] } ];

nv.addGraph(function() {
    var width = 300,
        height = 300;

    var chart = nv.models.pieChart()
        .x(function(d) { return d.label })
        .y(function(d) { return d.value })
        .showLabels(false)
        .color(d3.scale.category10().range())
        .width(width)
        .height(height);
    
      chart.tooltipContent(
    		  function(key, y, e, graph) {
          		return '<p><img style="width: 16px; height: 16px;" src="@routes.Assets.at("images/favicons/")'+key+'/favicon.ico"/>&#160;<b>' + key + '</b></p>' +
          		'<p>' +  e.value + ' snapshots</p>'
      });

      d3.select("#test1")
          .datum(testdata)
        .transition().duration(1200)
          .attr('width', width)
          .attr('height', height)
          .call(chart);

    return chart;
});

</script>
    
    </div>
    </div>
    
      <div>
      <h2>Archived Instances</h2>
    <table id="mementos_list" class="table table-striped table-condensed table-bordered">
        <thead>
            <th>Date &amp; Time</th>
            <th>Link to snapshot</th>
        </thead>
        <tbody>
        @for(m <- msb.getMementos()) {
            <tr>
                <td>@m.getDateTime()</td>
                <td><a href="@m.getUrl()">@m.getRel() @@ @m.getArchiveHost()</a></td>
            </tr>
        }
        </tbody>
    </table>
    <script type="text/javascript" charset="utf-8">
    jQuery.extend( jQuery.fn.dataTableExt.oSort, {
    "date-euro-pre": function ( a ) {
        if ($.trim(a) != '') {
            var frDatea = $.trim(a).split(' ');
            var frTimea = frDatea[1].split(':');
            var frDatea2 = frDatea[0].split('/');
            var yr = parseInt(frDatea2[2]);
            if( yr > 50 ) frDatea2[2] = "19"+frDatea2[2];
            if( yr <= 50 ) frDatea2[2] = "20"+frDatea2[2];
            var x = parseInt(frDatea2[2] + frDatea2[1] + frDatea2[0] + frTimea[0] + frTimea[1]);
        } else {
            var x = 10000000000000; // = l'an 1000 ...
        }
         
        return x;
    },
 
    "date-euro-asc": function ( a, b ) {
        return a - b;
    },
 
    "date-euro-desc": function ( a, b ) {
        return b - a;
    }
    } );

            $(document).ready(function() {
                $('#mementos_list').dataTable( {
                    "aoColumns": [
                      { "sType": "date-euro" },
                      null
                    ]
                } );
            } );
    </script>
    
    </div>
    
    }

    <div columns="1" style="margin: 0 auto;">

    <div style="text-align: center;">
     <p>
      Bookmarklet:&#160;<h:outputLink value="javascript:void(location.href='#{mementoBackingBean.absoluteUrl}/search.jsf?url='+escape(location.href))">BlueBox</h:outputLink>
     </p>
     <p>
      For more information on Memento, see&#160;<h:outputLink value="http://www.mementoweb.org/">www.mementoweb.org</h:outputLink>.
     </p>
     <p>
     This web interface uses the Memento aggregate TimeGate hosted by&#160;<h:outputLink value="http://lanl.gov">lanl.gov</h:outputLink>.<br/>
     This interface was created by the&#160;<h:outputLink value="http://www.webarchive.org.uk/">UK Web Archive</h:outputLink>.<br/>
     The source code is&#160;<h:outputLink value="https://github.com/ukwa/mementoweb-webclient">hosted on GitHub</h:outputLink>.
     </p>
    </div>
    
    </div>
    
    </div>
    </div>
      
    </body>
</html>