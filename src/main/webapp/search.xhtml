<f:view xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui"
    contentType="text/html">

	<f:metadata>
        <f:viewParam name="url" value="#{mementoBackingBean.url}" />
    </f:metadata>
    <h:head>
        <title>BlueBox - #{mementoBackingBean.url}</title>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	    <meta name="description" content="UK Web Archive - BlueBox"/>
    	<meta name="author" content="www.webarchive.org.uk"/>
		<f:facet name="first">
	      <h:outputStylesheet library="bootstrap" name="css/bootstrap.css" />
	      <h:outputStylesheet library="css" name="style.css" />
		</f:facet>
		<link href="resources/nvd3/src/nv.d3.css" rel="stylesheet" type="text/css"/>
<script src="resources/nvd3/lib/d3.v2.min.js"></script>
<script src="resources/nvd3/nv.d3.min.js"></script>
		<f:facet name="last">
		  <h:outputScript library="bootstrap" name="js/bootstrap.min.js"/>
		</f:facet>
    </h:head>
    <h:body>
    
     <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <a class="brand" href="http://www.webarchive.org.uk/"><img src="#{mementoBackingBean.absoluteUrl}/images/ukwa-icon-nobg-16.png"/>UK Web Archive</a>
          <div class="nav-collapse">
            <ul class="nav">
              <li><a href="http://www.webarchive.org.uk/">Home</a></li>
              <li class="active"><a href="#{mementoBackingBean.absoluteUrl}/">BlueBox</a></li>
              <li><a href="https://github.com/ukwa/">GitHub</a></li>
            </ul>
          </div><!--/.nav-collapse -->
        </div>
      </div>
    </div>
    
    <div class="container">

      <!-- Example row of columns -->
      <div class="row first-row">
    
	<p:ajaxStatus style="float:right;" id="ajaxStatusPanel">  
    	<f:facet name="start">  
        	<h:graphicImage value="images/busy.gif" />
	    </f:facet>
      
	    <f:facet name="complete">
    	    <h:outputText value="" />
    	</f:facet>  
	</p:ajaxStatus>      
        
      <h:form id="searchForm">
       <h:panelGrid columns="1" style="margin: 0 auto;">
        <h:panelGrid columns="2" border="0">
          <h:graphicImage value="images/mementologo.png" />
          <h:panelGrid columns="1" border="0" style="text-align: center;">        
            <h:panelGroup>
            <h:outputLabel value="URL" for="url" rendered="false"/>
            <h:inputText id="url" value="#{mementoBackingBean.url}" size="80"></h:inputText>
            </h:panelGroup>
            <p:commandButton value="Engage The TimeGate..." action="#{mementoBackingBean.submit}" />
          </h:panelGrid>
        </h:panelGrid>
       </h:panelGrid>
      
      <h:panelGrid columns="1" style="margin: 0 auto;" rendered="#{mementoBackingBean.urlSet}">
      <h:messages style='list-style: none; margin-left: 0;' fatalClass='alert alert-error' errorClass="alert alert-error" infoClass='alert alert-info' warnClass="alert alert-warn"/>
      <h:panelGrid columns="2" style="margin: 0 auto;">
      <h:panelGroup>
      <p>
        This URL (<h:outputLink value="#{mementoBackingBean.url}">#{mementoBackingBean.url}</h:outputLink>) has been archived #{mementoBackingBean.totalCount} times by #{mementoBackingBean.numHosts} organisation(s) between #{mementoBackingBean.firstMemento.dateTime.year} and #{mementoBackingBean.lastMemento.dateTime.year}.
      </p>
      <p>
        Also available as&#160;<h:outputLink value="#{mementoBackingBean.absoluteUrl}/timegate/json?url=#{mementoBackingBean.url}">JSON</h:outputLink>.
      </p>
      <p>
        <h:outputLink value="http://webcitation.org/archive?url=#{mementoBackingBean.url}">Click here to use WebCite&#153; to archive #{mementoBackingBean.url}</h:outputLink>.
      </p>
      
    <p:dataTable id="summaryTable" var="h" value="#{mementoBackingBean.hosts}" 
    		sortBy="#{mementoBackingBean.hostCounts[h]}" sortOrder="descending">
    
        <p:column sortBy="#{h}">  
            <f:facet name="header">  
                <h:outputText value="Host Archive" />  
            </f:facet>
            <h:graphicImage value="images/favicons/#{h}/favicon.ico"/>&#160;<h:outputLink value="http://#{h}">#{h}</h:outputLink>
        </p:column>
        
        <p:column sortBy="#{mementoBackingBean.hostCounts[h]}">  
            <f:facet name="header">  
                <h:outputText value="Archived Versions" />  
            </f:facet>
            <h:outputText value="#{mementoBackingBean.hostCounts[h]}" />
        </p:column>
        
    </p:dataTable>
    </h:panelGroup>
    <h:panelGroup>
                
<svg id="test1"></svg>

<script> 

  var testdata = [ 
                  {
                	    key: "Archive Hosts",
                	    values: [
                   #{mementoBackingBean.hostPieData} 
                   ] } ];

nv.addGraph(function() {
    var width = 300,
        height = 300;

    var chart = nv.models.pieChart()
        .x(function(d) { return d.label })
        .y(function(d) { return d.value })
        .showLabels(false)
        .color(d3.scale.category10().range())
        .width(width)
        .height(height);
    
      chart.tooltipContent(
    		  function(key, y, e, graph) {
          		return '<p><img style="width: 16px; height: 16px;" src="#{mementoBackingBean.absoluteUrl}/images/favicons/'+key+'/favicon.ico"/>&#160;<b>' + key + '</b></p>' +
          		'<p>' +  e.value + ' snapshots</p>'
      });

      d3.select("#test1")
          .datum(testdata)
        .transition().duration(1200)
          .attr('width', width)
          .attr('height', height)
          .call(chart);

    return chart;
});

</script>
    
    </h:panelGroup>
    </h:panelGrid>
    
      <h:panelGroup>
      <h2>Archived Instances</h2>
	<p:dataTable id="resultsTable" var="m" value="#{mementoBackingBean.mementos}" 
				sortBy="#{m.dateTime}" sortOrder="descending" 
				paginator="true" rows="25"  
                paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}" >
  
        <p:column sortBy="#{m.dateTime}">  
            <f:facet name="header">  
                <h:outputText value="Date" />  
            </f:facet>
            <h:outputText value="#{m.dateTime}" />
        </p:column>
        
        <p:column sortBy="#{m.archiveHost}">  
            <f:facet name="header">  
                <h:outputText value="Host Archive" />  
            </f:facet>
            <h:outputText value="#{m.archiveHost}" />
        </p:column>
  
        <p:column sortBy="#{m.url}">  
            <f:facet name="header">
                <h:outputText value="URL" />
            </f:facet>  
            <h:outputLink value="#{m.url}">Visit</h:outputLink>
        </p:column>  
  
    </p:dataTable>
    
    </h:panelGroup>
    
    </h:panelGrid>

      </h:form>
      
    <h:panelGrid columns="1" style="margin: 0 auto;">

    <h:panelGroup style="text-align: center;">
     <p>
      Bookmarklet:&#160;<h:outputLink value="javascript:void(location.href='#{mementoBackingBean.absoluteUrl}/search.jsf?url='+escape(location.href))">BlueBox</h:outputLink>
     </p>
     <p>
      For more information on Memento, see&#160;<h:outputLink value="http://www.mementoweb.org/">www.mementoweb.org</h:outputLink>.
     </p>
     <p>
     This web interface uses the Memento aggregate TimeGate hosted by&#160;<h:outputLink value="http://lanl.gov">lanl.gov</h:outputLink>.<br/>
     This interface was created by the&#160;<h:outputLink value="http://www.webarchive.org.uk/">UK Web Archive</h:outputLink>.<br/>
     The source code is&#160;<h:outputLink value="https://github.com/ukwa/mementoweb-webclient">hosted on GitHub</h:outputLink>.
     </p>
    </h:panelGroup>
    
    </h:panelGrid>
    
    </div>
    </div>
      
    </h:body>
</f:view>